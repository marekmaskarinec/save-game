import (
  "window.um"; "rect.um"; "canvas.um"; "std.um"
  ui = "../../src/d_ui.um"; font = "../../src/d_font.um"
)

fn main() {
  window.setup("Ahoy", 800, 600)
  var screen: rect.Rect
  count := 0
  ui.init(font.loadFont("data/font_sans.ttf", 16))

  for (window.cycle(screen)) {
    screen.w = window.w
    screen.h = window.h


    canvas.drawRect(0xFFAAAAFF, screen)
    ui.begin()
    
    ui.setJoinWindows(true)
      ui.beginWindow("Test", rect.Rect{200, 80, 200, 300})
      ui.beginWindow("Controller", rect.Rect{200, 80, 200, 300})
        if (ui.putButton("Add").pressed) {
          count += 1;
        }
        if (ui.putButton("Remove").pressed) {
          count -= 1;
        }
    ui.setJoinWindows(false)

    ui.setJoinWindows(true)
      ui.beginWindow("Controlled", rect.Rect{280, 80, 230, 350})
        for i := 0; i < count; i++ {
          buf := str(make([]char, 256))
          sprintf(buf, "%d", i)
          ui.putButton(buf)
        }
    ui.setJoinWindows(false)

    ui.end()
  }
}
